---
/**
 * Chatbot Widget - Microsoft Bot Framework Web Chat
 * Displays as a floating chat button that opens the chatbot interface
 */

interface Props {
  position?: 'bottom-right' | 'bottom-left';
  buttonColor?: string;
}

const { position = 'bottom-right', buttonColor = '#0078D4' } = Astro.props;

const positionClasses = {
  'bottom-right': 'bottom-6 right-6',
  'bottom-left': 'bottom-6 left-6',
};
---

<div class="chatbot-widget">
  <!-- Floating Chat Button -->
  <button
    id="chatbot-toggle"
    class={`fixed ${positionClasses[position]} z-50 rounded-full p-4 shadow-lg transition-transform hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-300`}
    style={`background-color: ${buttonColor}`}
    aria-label="Open chat"
  >
    <svg
      class="h-6 w-6 text-white"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
      ></path>
    </svg>
  </button>

  <!-- Chat Window -->
  <div
    id="chatbot-window"
    class={`fixed ${positionClasses[position]} z-40 hidden w-full max-w-md rounded-lg bg-white shadow-2xl`}
    style="height: 600px; max-height: 90vh;"
  >
    <!-- Chat Header -->
    <div class="flex items-center justify-between rounded-t-lg p-4" style={`background-color: ${buttonColor}`}>
      <h3 class="text-lg font-semibold text-white">Chat with us</h3>
      <button id="chatbot-close" class="text-white hover:text-gray-200 focus:outline-none" aria-label="Close chat">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Chat Content -->
    <div class="h-full">
      <iframe
        src={`https://webchat.botframework.com/embed/bot-test-service?s=${import.meta.env.PUBLIC_BOT_SECRET}`}
        class="h-full w-full rounded-b-lg border-0"
        title="Chatbot"></iframe>
    </div>
  </div>
</div>

<script>
  const toggleButton = document.getElementById('chatbot-toggle');
  const closeButton = document.getElementById('chatbot-close');
  const chatWindow = document.getElementById('chatbot-window');

  toggleButton?.addEventListener('click', () => {
    chatWindow?.classList.toggle('hidden');
    toggleButton?.classList.toggle('hidden');
  });

  closeButton?.addEventListener('click', () => {
    chatWindow?.classList.add('hidden');
    toggleButton?.classList.remove('hidden');
  });
</script>

<style>
  .chatbot-widget {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  /* Smooth transitions */
  #chatbot-window {
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Ensure iframe fills the container properly */
  #chatbot-window iframe {
    min-height: 500px;
  }
</style>
