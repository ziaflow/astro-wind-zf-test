---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Features2 from '~/components/widgets/Features2.astro';
import Features3 from '~/components/widgets/Features3.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import BlogLatestPosts from '~/components/widgets/BlogLatestPosts.astro';
import Stats from '~/components/widgets/Stats.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';
import ContactUs from '~/components/widgets/Contact.astro';
import Brands from '~/components/widgets/Brands.astro';
import LocalBusinessSchema from '~/components/seo/LocalBusinessSchema.astro';

const metadata = {
  title: 'Phoenix Web Development & Digital Marketing Agency | ZiaFlow',
  description:
    'Custom websites, strategic SEO, PPC, and automation for Arizona service businesses. 50+ clients trust our Phoenix team for measurable growth. Book a free strategy session.',
  ignoreTitleTemplate: true,
  openGraph: {
    url: 'https://ziaflow.com/',
    siteName: 'ZiaFlow',
    type: 'website',
    locale: 'en',
    title: 'Phoenix Web Development & Digital Marketing Agency | ZiaFlow', // Kept original title as "Blog" seemed incorrect for home
    description:
      'Custom websites, strategic SEO, PPC, and automation for Arizona service businesses. 50+ clients trust our Phoenix team for measurable growth. Book a free strategy session.',
    images: [
      {
        url: 'https://gmldsdtmahtgrbwwowtn.supabase.co/storage/v1/object/sign/website-test/img/Gemini_Generated_Image_k750obk750obk750.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV82M2Y5NTg4Mi1kODM0LTQ5NDAtOGZmMy1hZjRjYjFhMTgxMTUiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJ3ZWJzaXRlLXRlc3QvaW1nL0dlbWluaV9HZW5lcmF0ZWRfSW1hZ2Vfazc1MG9iazc1MG9iazc1MC5wbmciLCJpYXQiOjE3NjU3NzcyNjIsImV4cCI6MTc2ODM2OTI2Mn0.hgxadaMuQQ09A97vMrpIxODVc0Ehe7ROPAn64N1yTOU',
        width: 1200,
        height: 628,
        alt: 'ZiaFlow Digital Growth Partner',
      },
    ],
  },
  extend: {
    meta: [
      {
        property: 'og:logo',
        content:
          'https://gmldsdtmahtgrbwwowtn.supabase.co/storage/v1/object/sign/website-test/img/Gemini_Generated_Image_k750obk750obk750.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV82M2Y5NTg4Mi1kODM0LTQ5NDAtOGZmMy1hZjRjYjFhMTgxMTUiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJ3ZWJzaXRlLXRlc3QvaW1nL0dlbWluaV9HZW5lcmF0ZWRfSW1hZ2Vfazc1MG9iazc1MG9iazc1MC5wbmciLCJpYXQiOjE3NjU3NzcyNjIsImV4cCI6MTc2ODM2OTI2Mn0.hgxadaMuQQ09A97vMrpIxODVc0Ehe7ROPAn64N1yTOU',
      },
    ],
  },
};
---

<Layout metadata={metadata}>
  <LocalBusinessSchema />

  <!-- HERO -->
  <Hero
    tagline={`<span class="text-black dark:text-white">Phoenix Web Development & Digital Marketing</span>`}
    image={{
      src: 'https://images.unsplash.com/photo-1557324232-b8917d3c3dcb?crop=entropy&cs=srgb&fm=jpg&ixid=M3wxMDczMTJ8MHwxfHNlYXJjaHwxfHxwcm9ncmFtbWluZyUyMGNvZGUlMjBzY3JlZW58ZW58MHwwfHx8MTc2MzkyMjMwM3ww&ixlib=rb-4.1.0&q=85',
      alt: 'ZiaFlow Digital Growth Partner',
    }}
    title="Phoenix Web Development & Digital Marketing That Delivers Results"
    subtitle="Conversion-first websites, strategic local SEO, PPC, and automation - trusted by Arizona service businesses for measurable growth."
    actions={[
      {
        variant: 'primary',
        text: 'Book Free Strategy Session',
        icon: 'tabler:square-rounded-arrow-right',
        href: 'https://outlook.office.com/book/ZiaFlowIntake@ziaflow.com/?ismsaljsauthenabled',
      },
      {
        variant: 'secondary',
        text: 'Contact Us',
        href: '/contact',
        class: 'text-lg px-8 py-4 min-h-[56px] w-full sm:w-auto',
      },
    ]}
  >
    <Fragment slot="subtitle">
      <div class="mt-6 text-xl text-muted dark:text-slate-300">
        We move beyond simply driving traffic; we generate qualified leads that convert into loyal customers, delivering
        measurable results that fuel your growth.
      </div>
    </Fragment>
  </Hero>

  <!-- CONTACT + BOOKING -->
  <section class="px-4 py-16 mx-auto max-w-5xl sm:px-6 lg:px-8">
    <div class="grid gap-6 place-items-center">
      <div class="flex w-full max-w-3xl">
        <ContactUs
          id="form"
          accessKey="45824078-d31c-4031-9b48-404ac962a7a6"
          title="Start Your Digital Transformation"
          subtitle="Partner with the Phoenix digital marketing agency trusted by 50+ local businesses. Get a custom strategy for your business goals."
          button="Contact ZiaFlow"
          inputs={[
            {
              type: 'text',
              name: 'name',
              label: 'Full Name',
            },
            {
              type: 'email',
              name: 'email',
              label: 'Email Address',
            },
            {
              type: 'text',
              name: 'phone',
              label: 'Phone Number',
            },
            {
              type: 'hidden',
              name: 'utm_source',
              label: '',
            },
            {
              type: 'hidden',
              name: 'utm_medium',
              label: '',
            },
            {
              type: 'hidden',
              name: 'utm_campaign',
              label: '',
            },
            {
              type: 'hidden',
              name: 'clarity_session_id',
              label: '',
            },
            {
              type: 'hidden',
              name: 'event_id',
              label: '',
            },
          ]}
          textarea={{
            label: 'Tell us about your goals',
            placeholder:
              'What challenges are you facing? What results are you looking for? Share details that help us understand your needs.',
          }}
          disclaimer={{
            label:
              'By submitting this form, you agree to our privacy policy. We never share your information with third parties.',
          }}
          description="ðŸ”’ 100% Privacy Guaranteed. Trusted by 50+ AZ Businesses. We typically respond within 24 hours."
        />
      </div>
    </div>
  </section>

  <!-- VALUE PROPOSITION -->
  <Features2
    title="Your Partner for Digital Growth"
    subtitle="Since 2021, ZiaFlow has delivered measurable results for 50+ Arizona service businesses - from 150% increases in qualified leads to top-3 local search rankings across Phoenix, Scottsdale, Tempe, and Mesa."
    tagline="Why Phoenix Businesses Choose ZiaFlow"
    items={[
      {
        title: 'ROI-Focused Campaigns',
        description: 'Every strategy we implement is designed to maximize your return on investment.',
        icon: 'tabler:chart-arrows',
      },
      {
        title: 'Custom Solutions',
        description: 'Tailored strategies for your industry, market, and specific growth goals.',
        icon: 'tabler:tool',
      },
      {
        title: 'Measurable Results',
        description: 'Transparent reporting with clear ROI on every campaign.',
        icon: 'tabler:chart-line',
      },
      {
        title: 'Local Expertise',
        description: 'Deep understanding of Arizona market dynamics and customer behavior.',
        icon: 'tabler:map-pin',
      },
      {
        title: 'Transparent Performance Tracking',
        description: 'Our custom dashboards provide a clear view of how your investment is performing.',
        icon: 'tabler:eye',
      },
    ]}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-gray-100 dark:bg-slate-900"></div>
    </Fragment>
  </Features2>

  <!-- TRUST STATS -->
  <Stats
    stats={[
      { title: 'Arizona Clients', amount: '50+' },
      { title: 'Avg. Lead Growth', amount: '150%' },
      { title: 'Google Rating', amount: '5.0â˜…' },
      { title: 'Years in Phoenix', amount: '4+' },
    ]}
    tagline="Trusted by Phoenix-Area Service Businesses"
  />

  <!-- SERVICES GRID -->
  <Features3
    id="services"
    tagline="Our Expertise"
    title="Comprehensive Digital Solutions"
    subtitle="We combine strategic lead generation, advanced AI automation, and bespoke software to deliver tangible outcomes."
    columns={3}
    items={[
      {
        title: 'SEO Services',
        description:
          'Are competitors outranking you on Google? Our local SEO strategies elevate home service businesses and medical practices. We helped Phoenix-based plumbers achieve a 300% increase in calls.',
        icon: 'tabler:search',
        callToAction: {
          text: 'Get a free SEO audit',
          href: '/services/seo',
          variant: 'link',
        },
      },
      {
        title: 'AI Automation & Machine Learning',
        description:
          'Stop losing leads because of slow follow-up. Our AI automation builds intelligent systems that nurture prospects 24/7. We leverage RPA and generative AI to streamline operations.',
        icon: 'tabler:robot',
        callToAction: {
          text: 'Request a consultation',
          href: '/services/automation',
          variant: 'link',
        },
      },
      {
        title: 'Custom Software Development',
        description:
          'We build custom software that scales with you. Whether you need a CRM for home services, a patient portal, or an ecommerce platform, we create software that works for you.',
        icon: 'tabler:code',
        callToAction: {
          text: 'Schedule consultation',
          href: '/services/software',
          variant: 'link',
        },
      },
      {
        title: 'PPC Management & Google Ads',
        description:
          'Ensure every dollar of your ad spend generates qualified leads. Our PPC management focuses on high-intent keywords to connect you with ready-to-convert customers.',
        icon: 'tabler:ad',
        callToAction: {
          text: "Let's talk",
          href: '/services/ppc',
          variant: 'link',
        },
      },
      {
        title: 'Web Development Services',
        description:
          'We create responsive, conversion-optimized websites that turn visitors into customers. Optimized for local rankings and building trust.',
        icon: 'tabler:device-laptop',
        callToAction: {
          text: 'Get performance review',
          href: '/services/web-development',
          variant: 'link',
        },
      },
      {
        title: 'Social Media Marketing',
        description:
          'Effective social media requires a strategy. We utilize strategic content and targeted ad campaigns to showcase your expertise and build trust.',
        icon: 'tabler:brand-facebook',
        callToAction: {
          text: 'See success stories',
          href: '/services/social-media',
          variant: 'link',
        },
      },
      {
        title: 'Cloud Solutions',
        description:
          'Secure, scalable cloud infrastructure for your growing business. We specialize in Azure and AWS migrations, ensuring your data is safe and accessible.',
        icon: 'tabler:cloud',
        callToAction: {
          text: 'Learn about Cloud',
          href: '/services/cloud',
          variant: 'link',
        },
      },
      {
        title: 'E-commerce Solutions',
        description:
          'Turn your website into a 24/7 sales machine. We build high-converting online stores on Shopify and WooCommerce tailored to your brand.',
        icon: 'tabler:shopping-cart',
        callToAction: {
          text: 'Start selling online',
          href: '/services/ecommerce',
          variant: 'link',
        },
      },
    ]}
  />

  <!-- CASE STUDIES -->
  <section class="px-4 py-16 mx-auto max-w-7xl sm:px-6 lg:px-8 lg:py-20">
    <div class="mb-8 text-center">
      <h2 class="text-3xl font-bold tracking-tight sm:text-4xl">Real Results for Arizona Businesses</h2>
      <p class="mt-4 text-lg text-muted">Documented case studies from Phoenix-area clients</p>
    </div>

    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
      <article class="p-6 bg-white rounded-lg shadow-md dark:bg-slate-900">
        <h3 class="text-xl font-semibold">Scottsdale Contractor</h3>
        <p class="mt-3 text-muted">
          Site redesign + local SEO â†’ <strong>150% increase</strong> in online inquiries in 90 days.
        </p>
        <a class="inline-block mt-4 text-primary hover:underline" href="/case-studies/scottsdale-contractor">
          Read case study â†’
        </a>
      </article>

      <article class="p-6 bg-white rounded-lg shadow-md dark:bg-slate-900">
        <h3 class="text-xl font-semibold">Tempe Medical Practice</h3>
        <p class="mt-3 text-muted">
          Technical SEO + Google Ads â†’ <strong>200% visibility lift</strong> and 80% more appointments.
        </p>
        <a class="inline-block mt-4 text-primary hover:underline" href="/case-studies/tempe-medical">
          Read case study â†’
        </a>
      </article>

      <article class="p-6 bg-white rounded-lg shadow-md dark:bg-slate-900">
        <h3 class="text-xl font-semibold">Mesa Home Services</h3>
        <p class="mt-3 text-muted">
          Hyperlocal social ads + lead optimization â†’ <strong>60% more</strong> qualified leads.
        </p>
        <a class="inline-block mt-4 text-primary hover:underline" href="/case-studies/mesa-home-services">
          Read case study â†’
        </a>
      </article>
    </div>
  </section>

  <!-- TESTIMONIALS -->
  <Testimonials
    title="Trusted by Arizona Business Owners"
    tagline="Client Success Stories"
    testimonials={[
      {
        testimonial:
          'Ziaflow is a top-notch company with great service, expert knowledge, and competitive prices. Highly recommended!',
        name: 'J. M.',
        job: 'Investor',
      },
      {
        testimonial:
          'ZiaFlow has transformed our business with their automation solutions. Their tailored approach and expertise have streamlined our processes, saving us time and boosting our productivity. Highly recommend!',
        name: 'K. B.',
        job: 'COO',
      },
      {
        testimonial:
          'When it comes to website building and SEO, Ziaflow is very knowledgeable and extremely efficient. They helped me and some of my clients with website consulting and optimization. They are very affordable for small businesses that are growing and startups that need to get a head start.',
        name: 'S. K.',
        job: 'Comptroller',
      },
    ]}
  />

  <!-- WHY ZIAFLOW -->
  <Features2
    title="The ZiaFlow Growth Engine"
    subtitle="Local expertise, measurable results, and full-stack execution for service businesses."
    tagline="The ZiaFlow Difference"
    items={[
      {
        title: 'Instant Traffic. Lasting Authority.',
        description: "That's the PPC + SEO Advantage. We dominate search results to get you seen immediately.",
        icon: 'tabler:rocket',
      },
      {
        title: 'Speed + Stability = Results.',
        description: 'We build systems that deliver quick wins while establishing long-term market dominance.',
        icon: 'tabler:activity',
      },
      {
        title: 'Proven Results',
        description: 'Documented case studies with transparent reporting and clear metrics.',
        icon: 'tabler:chart-arrows',
      },
      {
        title: 'Full-Stack Team',
        description: 'Designers, developers, marketers, and automation engineers in-house.',
        icon: 'tabler:users',
      },
      {
        title: 'AI-Powered Efficiency',
        description: 'Leveraging cutting-edge automation to nurture leads and streamline your operations 24/7.',
        icon: 'tabler:cpu',
      },
      {
        title: 'Platform Partners',
        description: 'Microsoft, Google, TikTok partnerships and certifications.',
        icon: 'tabler:certificate',
      },
    ]}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
    </Fragment>
  </Features2>

  <!-- PARTNERS -->
  <Brands
    title="Certified Partnerships"
    subtitle="Trusted technology partners delivering enterprise-grade solutions"
    icons={[]}
    images={[
      {
        src: 'https://ruhnueopjedaywiqhpgi.supabase.co/storage/v1/object/sign/web-img/img/microsoft_partner.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9iYWVmOWU2NS02ZmM0LTQ1YzItYTJmMi1kOTk3MWE2ODkxNzUiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJ3ZWItaW1nL2ltZy9taWNyb3NvZnRfcGFydG5lci5wbmciLCJpYXQiOjE3NjM3MTY0OTgsImV4cCI6MTc5NTI1MjQ5OH0.gI0uL9HziC3C9Wmk4h_y25SGy8haHg1IDTqlhe468oY',
        alt: 'Microsoft Partner',
      },
      {
        src: 'https://ruhnueopjedaywiqhpgi.supabase.co/storage/v1/object/sign/web-img/img/Google_Partner.png?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9iYWVmOWU2NS02ZmM0LTQ1YzItYTJmMi1kOTk3MWE2ODkxNzUiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJ3ZWItaW1nL2ltZy9Hb29nbGVfUGFydG5lci5wbmciLCJpYXQiOjE3NjM3MTY1NTQsImV4cCI6MTc5NTI1MjU1NH0.BnJ8Ly2mR6zrlzHQJK0HkLDRwXx0GV0Jme5cZRZROrU',
        alt: 'Google Partner',
      },
      {
        src: 'https://ruhnueopjedaywiqhpgi.supabase.co/storage/v1/object/sign/web-img/img/tiktok_partner.jpg?token=eyJraWQiOiJzdG9yYWdlLXVybC1zaWduaW5nLWtleV9iYWVmOWU2NS02ZmM0LTQ1YzItYTJmMi1kOTk3MWE2ODkxNzUiLCJhbGciOiJIUzI1NiJ9.eyJ1cmwiOiJ3ZWItaW1nL2ltZy90aWt0b2tfcGFydG5lci5qcGciLCJpYXQiOjE3NjM3MTY1ODMsImV4cCI6MTc5NTI1MjU4M30.EouHS3SXErg0EJqUFYh2abbFfhYZctL3SFZd2eU82bQ',
        alt: 'TikTok Partner',
      },
    ]}
  />

  <!-- PRIMARY CTA -->
  <CallToAction
    title="Ready to Grow Your Business?"
    subtitle="Stop guessing and start seeing real results. Whether you are a home service company seeking consistent growth, a medical practice aiming for more quality patients, or an ecommerce business ready to scale, ZiaFlow has the expertise to help you succeed."
    actions={[
      {
        variant: 'primary',
        text: 'Book Free Strategy Session',
        href: 'https://outlook.office.com/book/ZiaFlowIntake@ziaflow.com/?ismsaljsauthenabled',
        icon: 'tabler:calendar',
      },
      {
        variant: 'secondary',
        text: 'Email Us',
        href: 'mailto:info@ziaflow.com',
      },
    ]}
  >
    <Fragment slot="content">
      <div class="mt-8 text-left max-w-3xl mx-auto bg-white/10 dark:bg-slate-900/50 p-6 rounded-lg backdrop-blur-sm">
        <h3 class="text-xl font-bold mb-4 text-center">Hereâ€™s what to expect:</h3>
        <ul class="space-y-3">
          <li class="flex items-start">
            <span class="mr-2 text-primary font-bold">1.</span>
            <span
              ><strong>Free Strategy Session:</strong> We analyze your current marketing efforts and identify key growth
              opportunities.</span
            >
          </li>
          <li class="flex items-start">
            <span class="mr-2 text-primary font-bold">2.</span>
            <span
              ><strong>Custom Action Plan:</strong> You receive a tailored plan detailing how we will generate measurable
              results for your business.</span
            >
          </li>
          <li class="flex items-start">
            <span class="mr-2 text-primary font-bold">3.</span>
            <span
              ><strong>Achieve Your Goals:</strong> Watch your business grow with more calls, a fuller schedule, and increased
              sales.</span
            >
          </li>
        </ul>
        <p class="mt-6 text-center font-semibold">Don't let your competitors win the customers you deserve.</p>
      </div>
    </Fragment>
  </CallToAction>

  <!-- BLOG -->
  <BlogLatestPosts
    title="Digital Marketing Insights"
    information="Local SEO, automation playbooks, CRO, and case studies for Arizona businesses."
  />

  <!-- FAQ -->
  <FAQs
    title="Frequently Asked Questions"
    subtitle="Answers to common questions about our services and process."
    tagline="FAQ"
    classes={{ container: 'max-w-6xl' }}
    items={[
      {
        title: 'What makes ZiaFlow different from other agencies?',
        description:
          "We specialize in the home services, medical, and ecommerce sectors, understanding their unique challenges. Our in-house team includes software developers and AI experts, allowing us to build custom solutions that other agencies can't.",
      },
      {
        title: 'How do you measure success?',
        description:
          'We focus on what matters: leads and revenue. Our transparent dashboards track calls, appointments, and sales, providing clear insight into your ROI.',
      },
      {
        title: 'Do you work with businesses outside of Arizona?',
        description:
          'Yes. While we proudly serve businesses in Phoenix, Scottsdale, Tucson, and Glendale, we also partner with companies nationwide to provide digital marketing, custom software, and cloud solutions.',
      },
      {
        title: 'How quickly will I see results?',
        description:
          'PPC campaigns can generate leads within days, while SEO typically shows significant improvement in 3-6 months. We provide realistic timelines for all projects upfront.',
      },
      {
        title: 'What is included in your marketing automation services?',
        description:
          'Our AI-powered automation can handle lead nurturing, appointment scheduling, customer follow-ups, review requests, and service inquiries. We customize every system to fit your specific business processes.',
      },
    ]}
  />

  <!-- CONTACT OPTIONS -->
  <Features3
    title="Contact ZiaFlow"
    subtitle="Choose the method that works best for you"
    columns={3}
    items={[
      {
        title: 'Email',
        icon: 'tabler:mail',
        callToAction: {
          text: 'info@ziaflow.com',
          href: 'mailto:info@ziaflow.com',
          variant: 'link',
        },
      },
      {
        title: 'Visit',
        icon: 'tabler:map-pin',
        callToAction: {
          text: 'Phoenix, AZ 85023',
          href: 'https://maps.google.com?q=Phoenix+AZ+85023',
          variant: 'link',
        },
      },
      {
        title: 'Schedule',
        icon: 'tabler:calendar',
        callToAction: {
          text: 'Book Meeting',
          href: 'https://outlook.office.com/book/ZiaFlowIntake@ziaflow.com/?ismsaljsauthenabled',
          variant: 'link',
        },
      },
    ]}
  />

  <!-- Client-side Tracking Script -->
  <script is:inline>
    (function () {
      const w = window;

      function getParam(name) {
        try {
          return new URLSearchParams(w.location.search).get(name) || '';
        } catch {
          return '';
        }
      }

      function setHiddenField(form, name, value) {
        const input = form.querySelector(`input[name="${name}"]`);
        if (input) input.value = value;
      }

      function populateHiddenFields() {
        const wrapper = document.getElementById('form');
        if (!wrapper) return;

        const form = wrapper.querySelector('form') || wrapper;

        // Populate UTM parameters
        ['utm_source', 'utm_medium', 'utm_campaign'].forEach((k) => {
          setHiddenField(form, k, getParam(k));
        });

        // Populate Clarity session ID
        if (typeof w.clarity === 'function' && typeof w.clarity.getSessionId === 'function') {
          try {
            w.clarity.getSessionId((id) => {
              setHiddenField(form, 'clarity_session_id', id || '');
            });
          } catch (err) {
            console.error('Clarity session ID error:', err);
          }
        } else if (Array.isArray(w.dataLayer)) {
          for (let i = w.dataLayer.length - 1; i >= 0; i--) {
            const item = w.dataLayer[i];
            if (item && item.clarity_session_id) {
              setHiddenField(form, 'clarity_session_id', item.clarity_session_id);
              break;
            }
          }
        }
      }

      function attachFormTracking() {
        const wrapper = document.getElementById('form');
        if (!wrapper) return;

        const form = wrapper.querySelector('form') || wrapper;
        if (!form) return;

        form.addEventListener(
          'submit',
          function () {
            try {
              const eventId = 'ev_' + Date.now();
              setHiddenField(form, 'event_id', eventId);

              // DataLayer push
              w.dataLayer = w.dataLayer || [];
              w.dataLayer.push({
                event: 'form_submit',
                form_id: 'homepage_contact',
                event_id: eventId,
              });

              // Google Analytics
              if (typeof w.gtag === 'function') {
                w.gtag('event', 'form_submit', {
                  event_category: 'engagement',
                  event_label: 'homepage_contact',
                  event_id: eventId,
                });
              }
            } catch (err) {
              console.error('Form tracking error:', err);
            }
          },
          { passive: true }
        );
      }

      function attachCTAClickTracking() {
        document.addEventListener(
          'click',
          function (e) {
            const el = e.target?.closest ? e.target.closest('a') : null;
            if (!el || !el.href) return;

            const href = el.getAttribute('href') || '';

            // Track booking link clicks
            if (href.indexOf('outlook.office.com') !== -1) {
              const eventId = 'ev_cta_' + Date.now();
              w.dataLayer = w.dataLayer || [];
              w.dataLayer.push({
                event: 'cta_click',
                cta: 'book_consult',
                href: href,
                event_id: eventId,
              });

              if (typeof w.gtag === 'function') {
                w.gtag('event', 'click', {
                  event_category: 'CTA',
                  event_label: 'book_consult',
                  event_id: eventId,
                });
              }
            }

            // Track contact link clicks
            if (href.indexOf('/contact') !== -1 || href.indexOf('#estimate') !== -1) {
              const eventId = 'ev_cta_' + Date.now();
              w.dataLayer = w.dataLayer || [];
              w.dataLayer.push({
                event: 'cta_click',
                cta: 'contact',
                href: href,
                event_id: eventId,
              });

              if (typeof w.gtag === 'function') {
                w.gtag('event', 'click', {
                  event_category: 'CTA',
                  event_label: 'contact',
                  event_id: eventId,
                });
              }
            }
          },
          { passive: true }
        );
      }

      // Initialize on DOM ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function () {
          populateHiddenFields();
          attachFormTracking();
          attachCTAClickTracking();
        });
      } else {
        populateHiddenFields();
        attachFormTracking();
        attachCTAClickTracking();
      }
    })();
  </script>
</Layout>
