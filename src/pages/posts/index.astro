---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import { sanityClient } from 'sanity:client';
import type { SanityDocument } from '@sanity/client';

const POSTS_QUERY = `*[
  _type == "post"
  && defined(slug.current)
]|order(publishedAt desc){_id, title, slug, publishedAt, mainImage}`;

const posts = await sanityClient.fetch<SanityDocument[]>(POSTS_QUERY);

const metadata = {
  title: 'Blog Posts',
};
---

<Layout metadata={metadata}>
  <Hero tagline="Blog" title="Latest Posts" subtitle="Stay updated with our latest news and insights." />

  <section class="max-w-4xl mx-auto px-6 py-12">
    <div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
      {
        posts.map((post) => (
          <a href={`/posts/${post.slug.current}`} class="block group">
            <article class="bg-white dark:bg-slate-900 shadow-lg rounded-lg overflow-hidden transition hover:shadow-xl">
              <div class="p-6">
                <h2 class="text-xl font-bold mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                  {post.title}
                </h2>
                <p class="text-gray-500 text-sm">{new Date(post.publishedAt).toLocaleDateString()}</p>
              </div>
            </article>
          </a>
        ))
      }
    </div>
  </section>
</Layout>
